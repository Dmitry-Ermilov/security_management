# Программный комплекс управления ИБ кибер-физической системы

## Цель
Разработать и обосновать программный комплекс, обеспечивающий эффективное управление ИБ КФС с учетом связности информационной и физической частей и рисков кибератак.

## Задачи
- Анализ угроз и уязвимостей КФС.
- Обзор методов и технологий защиты.
- Архитектура программного комплекса управления безопасностью.
- Реализация мониторинга, обнаружения и реагирования на инциденты.
- Тестирование и оценка эффективности решений.

## Объект и допущения
КФС рассматривается как типовой контур: физический объект (например БПЛА/робот/промышленный узел) + каналы связи (MQTT) + управляющие сервисы (edge/core). Для демонстрации используется стек мониторинга и реагирования в Docker.

## Архитектура решения
Сегментация на edge (каналы и сенсоры) и core (аналитика/сервисы).

```
[Physical devices] -> [MQTT broker] -> [Telegraf] -> [Elasticsearch] -> [Kibana]
        |                 |                |              |              |
        |                 |                |              |              +-> Dashboards/analytics
        |                 |                |              +-> Logstash (enrichment)
        |                 |                +-> Suricata IDS (traffic inspection)
        |                 +-> TLS/ACL
        +-> Wazuh Agent/FIM -> Wazuh Manager -> Elasticsearch

FastAPI (policies/alerts/actions) <-> PostgreSQL
TheHive/Cortex (cases/response) <-> FastAPI (stub integration)
```

Сети docker-compose разделены на `edge` и `core` для изоляции потоков управления и аналитики.

## Анализ угроз и уязвимостей
Полный перечень угроз приведен в `Перечень сформированных угроз.xlsx`. Критические группы угроз:
- Канал управления: перехват/подмена команд (MITM), внедрение команд, replay атак.
- Канал телеметрии: подмена/искажение данных, нарушение целостности, скрытая эксфильтрация.
- MQTT брокер: brute-force, flood/DoS, обход ACL, подмена client-id.
- ПО и прошивки: несанкционированные OTA обновления, подмена артефактов, вредоносные модули.
- Инфраструктура: уязвимости в контейнерах/ES/Logstash, конфигурационные ошибки, отсутствие сегментации.
- Физическая часть: доступ к устройствам, подмена датчиков, вмешательство в питание.

## Методы и технологии защиты
- TLS и ACL на MQTT для конфиденциальности и авторизации.
- IDS (Suricata) для детектирования сетевых аномалий и сигнатур.
- HIDS/FIM (Wazuh) для контроля целостности файлов и поведения хоста.
- Централизованный сбор событий (Logstash) и аналитика (Elasticsearch + Kibana).
- Реакция и оркестрация (FastAPI + TheHive/Cortex) для обработки инцидентов и действий.

## Реализация комплекса
- MQTT брокер с TLS/ACL: `mosquitto/conf/mosquitto.conf`, `mosquitto/conf/acl`, `mosquitto/conf/passwd`.
- Сбор телеметрии и маршрутизация по индексам: `telegraf/telegraf.conf`.
- IDS правила: `suricata/custom.rules`.
- Прием и загрузка событий IDS/аудита: `logstash/logstash.conf`.
- API управления политиками/алертами: `fastapi/main.py`.
- Оркестрация стека: `docker-compose.yml`.

## Мониторинг, обнаружение и реагирование
- Мониторинг: телеметрия/команды/события через Telegraf в индексы `telemetry-*`, `command-*`, `mqtt-*`.
- Обнаружение: Suricata сигнатуры (аномальный размер MQTT, неизвестный client-id, replay) и Wazuh FIM.
- Реагирование: FastAPI принимает алерты, оценивает политики и формирует действия; TheHive/Cortex используется для кейс-менеджмента (интеграция может быть расширена).

## Тестирование и оценка эффективности
Сценарии проверки:
1. Базовая телеметрия: `simulate_telemetry.py` -> индексы telemetry/command/event.
2. MQTT аномалии: изменить client-id или размеры сообщений -> алерты Suricata.
3. Flood/DoS на брокер: рост частоты сообщений -> алерт и политика реагирования.
4. Нарушение TLS/ACL: попытка подключения без сертификата или с неверным логином.
5. Несанкционированная модификация файлов (Wazuh FIM) -> событие в `wazuh-*`.

Метрики оценки:
- MTTD (время до обнаружения),
- точность (FP/FN) на тестовом наборе,
- задержка доставки в ES,
- полнота покрытия угроз по перечню.

Фактические результаты (скриншоты):
- Telemetry: события в `telemetry-*`, поля `mqtt_consumer.*` (Рис. Т1).
- Command: команды в `command-*` (Рис. Т2).
- MQTT: события в `mqtt-*` (Рис. Т3).
- Suricata: демонстрационное событие в `suricata-*` (Рис. Т4).
- Wazuh: демонстрационное событие в `wazuh-*` (Рис. Т5).

Вставки изображений:
- Рис. Т1 — Telemetry: `screenshots/telemetry.png`
- Рис. Т2 — Command: `screenshots/command.png`
- Рис. Т3 — MQTT: `screenshots/mqtt.png`
- Рис. Т4 — Suricata: `screenshots/suricata.png`
- Рис. Т5 — Wazuh: `screenshots/wazuh.png`
- Рис. Д1 — Дашборд: `screenshots/dashboard.png`

Критерии приемки:
- События видны в Kibana по нужным индексам.
- IDS срабатывает по кастомным правилам.
- FastAPI возвращает действия согласно политикам.

## Вывод
Сформирован программный комплекс управления ИБ КФС с мониторингом, детектированием и механизмами реагирования. Архитектура учитывает связность физического и информационного контуров, а также типовые риски КФС. Для развития проекта рекомендуется расширить набор правил, подключить реальные агенты Wazuh и формализовать метрики эффективности на эмпирических данных.
